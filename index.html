<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CPA Perfect Platform 2027</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { font-family: 'Helvetica Neue', Arial, sans-serif; background-color: #f3f4f6; transition: background-color 0.3s; }
        .tab-content { display: none; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }
        .card { background: white; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); padding: 1.5rem; margin-bottom: 1.5rem; transition: transform 0.2s; }
        .card:hover { transform: translateY(-2px); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Dark Mode Support */
        body.dark-mode { background-color: #1a202c; color: #e2e8f0; }
        body.dark-mode .card { background-color: #2d3748; color: #e2e8f0; }
        body.dark-mode nav { background-color: #2d3748; }
        body.dark-mode nav button:hover { background-color: #4a5568; }
        body.dark-mode .text-gray-600 { color: #a0aec0; }
        body.dark-mode .text-gray-700 { color: #cbd5e0; }
        body.dark-mode .text-gray-800 { color: #f7fafc; }
        body.dark-mode input, body.dark-mode select { background-color: #4a5568; border-color: #718096; color: white; }
        body.dark-mode table thead tr { background-color: #4a5568; }
        body.dark-mode table tbody tr:hover { background-color: #2d3748; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen text-gray-800">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <header class="mb-8 flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-purple-600">CPA Perfect Platform</h1>
                <p class="text-gray-600 mt-1">Goal: 2027 May Short & Aug Essay</p>
            </div>
            <button onclick="toggleDarkMode()" class="p-2 rounded-full hover:bg-gray-200 transition">
                <i class="fas fa-moon text-xl text-gray-600"></i>
            </button>
        </header>

        <!-- Navigation Tabs -->
        <nav class="flex mb-8 bg-white rounded-xl shadow-sm p-1 overflow-x-auto">
            <button onclick="switchTab('dashboard')" class="flex-1 py-3 px-4 rounded-lg hover:bg-gray-50 focus:outline-none font-medium text-gray-500 transition" id="tab-dashboard"><i class="fas fa-tachometer-alt mr-2"></i>Dashboard</button>
            <button onclick="switchTab('timer')" class="flex-1 py-3 px-4 rounded-lg hover:bg-gray-50 focus:outline-none font-medium text-gray-500 transition" id="tab-timer"><i class="fas fa-stopwatch mr-2"></i>Study Timer</button>
            <button onclick="switchTab('schedule')" class="flex-1 py-3 px-4 rounded-lg hover:bg-gray-50 focus:outline-none font-medium text-gray-500 transition" id="tab-schedule"><i class="fas fa-calendar-alt mr-2"></i>Mock Exams</button>
            <button onclick="switchTab('scores')" class="flex-1 py-3 px-4 rounded-lg hover:bg-gray-50 focus:outline-none font-medium text-gray-500 transition" id="tab-scores"><i class="fas fa-chart-line mr-2"></i>Scores</button>
            <button onclick="switchTab('drills')" class="flex-1 py-3 px-4 rounded-lg hover:bg-gray-50 focus:outline-none font-semibold text-blue-600 transition" id="tab-drills"><i class="fas fa-pencil-alt mr-2"></i>Drills <span class="bg-red-500 text-white text-xs px-2 py-0.5 rounded-full ml-1">NEW</span></button>
            <button onclick="switchTab('roadmap')" class="flex-1 py-3 px-4 rounded-lg hover:bg-gray-50 focus:outline-none font-medium text-gray-500 transition" id="tab-roadmap"><i class="fas fa-map mr-2"></i>Roadmap</button>
        </nav>

        <!-- Tab: Drills -->
        <div id="drills" class="tab-content active">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <!-- Sidebar -->
                <div class="card md:col-span-1">
                    <h2 class="text-xl font-bold mb-4">Select Topic</h2>
                    <div class="space-y-2">
                        <button onclick="selectSubject('Financial')" class="w-full text-left px-4 py-3 rounded-lg bg-blue-50 hover:bg-blue-100 text-blue-700 font-medium transition flex justify-between items-center">
                            <span>Financial Accounting</span>
                            <i class="fas fa-chevron-right text-sm"></i>
                        </button>
                        <button onclick="selectSubject('Management')" class="w-full text-left px-4 py-3 rounded-lg bg-green-50 hover:bg-green-100 text-green-700 font-medium transition flex justify-between items-center">
                            <span>Management Accounting</span>
                            <i class="fas fa-chevron-right text-sm"></i>
                        </button>
                        <button onclick="selectSubject('Audit')" class="w-full text-left px-4 py-3 rounded-lg bg-yellow-50 hover:bg-yellow-100 text-yellow-700 font-medium transition flex justify-between items-center">
                            <span>Audit Theory</span>
                            <i class="fas fa-chevron-right text-sm"></i>
                        </button>
                        <button onclick="selectSubject('Company')" class="w-full text-left px-4 py-3 rounded-lg bg-purple-50 hover:bg-purple-100 text-purple-700 font-medium transition flex justify-between items-center">
                            <span>Company Law</span>
                            <i class="fas fa-chevron-right text-sm"></i>
                        </button>
                    </div>
                </div>

                <!-- Quiz Area -->
                <div class="card md:col-span-3 min-h-[400px]">
                    <div id="quiz-intro" class="text-center py-10">
                        <i class="fas fa-book-reader text-6xl text-gray-300 mb-4"></i>
                        <h2 class="text-2xl font-bold text-gray-700 mb-2">Ready to Practice?</h2>
                        <p class="text-gray-500">Select a subject from the left to start.</p>
                    </div>

                    <div id="level-selection" class="hidden text-center py-10">
                        <i class="fas fa-layer-group text-6xl text-blue-300 mb-4"></i>
                        <h2 class="text-2xl font-bold text-gray-700 mb-6" id="level-select-title">Select Level</h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 max-w-2xl mx-auto px-4">
                            <button onclick="startQuiz(currentSubject, 1)" class="p-6 bg-white border-2 border-green-200 rounded-xl hover:border-green-500 hover:bg-green-50 transition group">
                                <div class="text-green-600 font-bold text-xl mb-2">Level 1</div>
                                <div class="text-sm text-gray-500">Basic Definitions & Rules</div>
                                <div class="mt-2 text-xs bg-green-100 text-green-800 inline-block px-2 py-1 rounded">Beginner</div>
                            </button>
                            <button onclick="startQuiz(currentSubject, 2)" class="p-6 bg-white border-2 border-blue-200 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition group">
                                <div class="text-blue-600 font-bold text-xl mb-2">Level 2</div>
                                <div class="text-sm text-gray-500">Standard Calculations</div>
                                <div class="mt-2 text-xs bg-blue-100 text-blue-800 inline-block px-2 py-1 rounded">Intermediate</div>
                            </button>
                            <button onclick="startQuiz(currentSubject, 3)" class="p-6 bg-white border-2 border-purple-200 rounded-xl hover:border-purple-500 hover:bg-purple-50 transition group">
                                <div class="text-purple-600 font-bold text-xl mb-2">Level 3</div>
                                <div class="text-sm text-gray-500">Advanced Theory & App.</div>
                                <div class="mt-2 text-xs bg-purple-100 text-purple-800 inline-block px-2 py-1 rounded">Advanced</div>
                            </button>
                        </div>
                        <button onclick="resetQuizUI()" class="mt-8 text-gray-500 hover:text-gray-700 underline">Cancel</button>
                    </div>

                    <div id="quiz-container" class="hidden">
                        <div class="flex justify-between items-center mb-6 pb-4 border-b">
                            <h3 class="text-xl font-bold text-gray-800" id="quiz-subject-title">Subject</h3>
                            <span class="bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded dark:bg-blue-200 dark:text-blue-800" id="quiz-progress">Q1 / 5</span>
                        </div>
                        
                        <div class="mb-8">
                            <p class="text-lg text-gray-800 dark:text-gray-200 leading-relaxed mb-6" id="quiz-question-text">Question goes here...</p>
                            
                            <div class="space-y-3" id="quiz-options">
                                <!-- Options injected here -->
                            </div>
                        </div>

                        <div id="quiz-feedback" class="hidden mb-6 p-4 rounded-lg bg-gray-50 border border-gray-200 dark:bg-gray-700 dark:border-gray-600">
                            <h4 class="font-bold mb-2" id="feedback-title">Correct!</h4>
                            <p class="text-sm text-gray-600 dark:text-gray-300" id="feedback-text">Explanation...</p>
                        </div>

                        <div class="flex justify-end">
                            <button id="btn-next-question" onclick="nextQuestion()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg transition hidden">Next Question <i class="fas fa-arrow-right ml-2"></i></button>
                        </div>
                    </div>

                    <div id="quiz-result" class="hidden text-center py-10">
                        <div class="mb-6">
                            <i class="fas fa-trophy text-6xl text-yellow-400 mb-4 animate-bounce"></i>
                            <h2 class="text-3xl font-bold text-gray-800 mb-2">Quiz Completed!</h2>
                            <p class="text-xl text-gray-600">Your Score: <span id="quiz-final-score" class="font-bold text-blue-600">4/5</span></p>
                        </div>
                        <button onclick="resetQuizUI()" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-lg transition">Back to Menu</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="dashboard" class="tab-content">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Countdowns -->
                <div class="card md:col-span-2">
                    <h2 class="text-xl font-bold mb-4 flex items-center"><i class="fas fa-hourglass-half mr-2 text-blue-500"></i>Exam Countdown</h2>
                    <div id="countdown-list" class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                        <!-- Injected via JS -->
                    </div>
                </div>
                
                <!-- Total Study Time -->
                <div class="card bg-gradient-to-br from-blue-500 to-indigo-600 text-white">
                    <h2 class="text-xl font-bold mb-2">Total Study Time</h2>
                    <div class="text-4xl font-bold mb-1" id="total-study-time">0h 0m</div>
                    <p class="text-blue-100 text-sm">Keep pushing!</p>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                <!-- Subject Radar Chart -->
                <div class="card">
                    <h2 class="text-xl font-bold mb-4">Skill Balance (Radar)</h2>
                    <canvas id="radarChart" height="250"></canvas>
                </div>
                <!-- Phase Progress -->
                <div class="card">
                    <h2 class="text-xl font-bold mb-4">Current Phase: Foundation</h2>
                    <div class="prose prose-sm max-w-none text-gray-600 mb-4">
                        <ul class="list-disc pl-5">
                            <li>Focus: Financial & Management Accounting Calculation</li>
                            <li>Goal: Complete basic lectures by Aug 2026</li>
                            <li>Next Milestone: Dec 2026 Short Exam</li>
                        </ul>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-4 overflow-hidden">
                        <div class="bg-green-500 h-4 rounded-full transition-all duration-1000" style="width: 15%"></div>
                    </div>
                    <p class="text-xs text-right mt-1 text-gray-500">15% Complete</p>
                </div>
            </div>
        </div>

        <!-- Tab: Study Timer -->
        <div id="timer" class="tab-content">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="card text-center">
                    <h2 class="text-2xl font-bold mb-6">Focus Timer</h2>
                    <div class="text-6xl font-mono font-bold text-gray-800 mb-8" id="timer-display">00:00:00</div>
                    
                    <div class="flex justify-center space-x-4 mb-6">
                        <button onclick="startTimer()" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-8 rounded-full shadow-lg transition transform hover:scale-105" id="btn-start"><i class="fas fa-play mr-2"></i>Start</button>
                        <button onclick="pauseTimer()" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-8 rounded-full shadow-lg transition transform hover:scale-105 hidden" id="btn-pause"><i class="fas fa-pause mr-2"></i>Pause</button>
                        <button onclick="stopTimer()" class="bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-8 rounded-full shadow-lg transition transform hover:scale-105" id="btn-stop"><i class="fas fa-stop mr-2"></i>Log & Reset</button>
                    </div>

                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Subject</label>
                        <select id="timer-subject" class="block w-full rounded-md border-gray-300 shadow-sm p-3 border focus:ring-blue-500 focus:border-blue-500">
                            <option value="Financial">Financial Accounting (財務)</option>
                            <option value="Management">Management Accounting (管理)</option>
                            <option value="Audit">Audit (監査)</option>
                            <option value="Company">Company Law (企業)</option>
                            <option value="Tax">Tax Law (租税)</option>
                            <option value="Elective">Elective (選択)</option>
                        </select>
                    </div>
                </div>

                <div class="card">
                    <h2 class="text-xl font-bold mb-4">Recent Logs</h2>
                    <div class="overflow-y-auto max-h-80">
                        <table class="min-w-full text-sm">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-2 text-left">Date</th>
                                    <th class="px-4 py-2 text-left">Subject</th>
                                    <th class="px-4 py-2 text-right">Duration</th>
                                </tr>
                            </thead>
                            <tbody id="timer-logs-body">
                                <!-- Logs injected via JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab: Mock Exams -->
        <div id="schedule" class="tab-content">
            <div class="card">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold">Mock Exam Schedule (2026-2027 Forecast)</h2>
                    <span class="text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded">Estimated Dates</span>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full table-auto">
                        <thead>
                            <tr class="bg-gray-50 text-left border-b">
                                <th class="px-4 py-3">Date</th>
                                <th class="px-4 py-3">Type</th>
                                <th class="px-4 py-3">Exam Name</th>
                                <th class="px-4 py-3">Provider</th>
                                <th class="px-4 py-3">Status</th>
                            </tr>
                        </thead>
                        <tbody id="schedule-table-body" class="text-gray-700">
                            <!-- JS injected -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Tab: Scores -->
        <div id="scores" class="tab-content">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Input Form -->
                <div class="card col-span-1 border-t-4 border-blue-500">
                    <h2 class="text-lg font-bold mb-4">Record Score</h2>
                    <form id="score-form" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Exam/Drill Name</label>
                            <input type="text" id="score-name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" placeholder="e.g. Access Alpha #1">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Date</label>
                            <input type="date" id="score-date" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Subject</label>
                            <select id="score-subject" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                                <option value="Financial">Financial (財務)</option>
                                <option value="Management">Management (管理)</option>
                                <option value="Audit">Audit (監査)</option>
                                <option value="Company">Company (企業)</option>
                                <option value="Tax">Tax (租税)</option>
                                <option value="Elective">Elective (選択)</option>
                                <option value="Total">Total/Avg (総合)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Score (%)</label>
                            <input type="number" id="score-val" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" placeholder="70">
                        </div>
                        <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition font-bold">Save Score</button>
                    </form>
                </div>
                <!-- Chart & List -->
                <div class="card col-span-2">
                    <h2 class="text-lg font-bold mb-4">Performance History</h2>
                    <canvas id="scoreChart" height="200"></canvas>
                    <div class="mt-6 overflow-x-auto">
                        <table class="min-w-full text-sm">
                            <thead>
                                <tr class="border-b">
                                    <th class="text-left py-2">Date</th>
                                    <th class="text-left py-2">Exam</th>
                                    <th class="text-left py-2">Subject</th>
                                    <th class="text-left py-2">Score</th>
                                    <th class="text-left py-2">Action</th>
                                </tr>
                            </thead>
                            <tbody id="score-list-body">
                                <!-- Scores injected via JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab: Roadmap -->
        <div id="roadmap" class="tab-content">
            <div class="card">
                <div id="roadmap-content" class="prose max-w-none text-gray-700">
                    <!-- Markdown content injected via JS -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Data Management ---
        const DB_KEY_SCORES = 'cpa_scores_v2';
        const DB_KEY_LOGS = 'cpa_logs_v1';
        
        // Mock Data - Estimated based on typical schedules (2nd Sunday for Short, Late Aug for Essay)
        const mockExams = [
            { date: '2026-11-15', type: 'Short', name: 'Dec Short Mock (TAC/Ohara)', provider: 'TAC/Ohara', status: 'Practice' },
            { date: '2026-12-13', type: 'Short', name: 'Official Dec Short Exam', provider: 'CPAAOB', status: 'Target' },
            { date: '2027-04-25', type: 'Short', name: 'May Short Mock (TAC/Ohara)', provider: 'TAC/Ohara', status: 'Practice' },
            { date: '2027-05-23', type: 'Short', name: 'Official May Short Exam', provider: 'CPAAOB', status: 'Target' },
            { date: '2027-07-10', type: 'Essay', name: 'Essay Mock (TAC/Ohara)', provider: 'TAC/Ohara', status: 'Practice' },
            { date: '2027-08-20', type: 'Essay', name: 'Official Aug Essay Exam', provider: 'CPAAOB', status: 'Target' }
        ];

        const roadmapMarkdown = `# CPA 1.5 Year Strategy Roadmap

## Phase 0: Foundation (2026)
* **Feb - Mar**: Build study habits. Focus on Fin/Mgmt Accounting basics.
* **Apr - Jun**: Start Applied theory. Begin Audit & Company Law.
* **Jul - Sep**: **CRITICAL** Start Tax Law & Electives.
* **Oct - Dec**: **Dec Short Exam Challenge**. Aim to pass!

## Phase 1: Short Exam Mastery (Jan - May 2027)
* **Jan - Mar**: Solidify basics. 75%+ in drills.
* **Apr - May**: Peak conditioning. Rote memorization.

## Phase 2: Essay Sprint (Jun - Aug 2027)
* **Jun**: Revive Tax/Elective knowledge.
* **Jul**: Output training (Writing).
* **Aug**: Final adjustments.`;

        // --- State ---
        let scores = JSON.parse(localStorage.getItem(DB_KEY_SCORES)) || [];
        let logs = JSON.parse(localStorage.getItem(DB_KEY_LOGS)) || [];
        let timerInterval = null;
        let timerSeconds = 0;
        let isTimerRunning = false;

        let scoreChart = null;
        let radarChart = null;

        // --- Init ---
        document.addEventListener('DOMContentLoaded', () => {
            renderSchedule();
            renderCountdowns();
            renderRoadmap();
            renderScores();
            renderLogs();
            updateTotalTime();
            
            // Set default date to today
            document.getElementById('score-date').valueAsDate = new Date();
        });

        // --- Tabs ---
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            
            document.querySelectorAll('nav button').forEach(el => {
                el.classList.remove('text-blue-600', 'bg-blue-50');
                el.classList.add('text-gray-500');
            });
            const activeBtn = document.getElementById('tab-' + tabId);
            activeBtn.classList.add('text-blue-600', 'bg-blue-50');
            activeBtn.classList.remove('text-gray-500');
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
        }

        // --- Dashboard ---
        function renderCountdowns() {
            const container = document.getElementById('countdown-list');
            const targets = [
                { name: 'Dec 2026 Short', date: new Date('2026-12-13') },
                { name: 'May 2027 Short', date: new Date('2027-05-23') },
                { name: 'Aug 2027 Essay', date: new Date('2027-08-20') }
            ];
            
            const now = new Date();
            
            targets.forEach(target => {
                const diffTime = target.date - now;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                const el = document.createElement('div');
                el.className = 'flex flex-col p-4 bg-white dark:bg-gray-800 rounded-lg shadow border-l-4 border-blue-500 text-center';
                el.innerHTML = `
                    <span class="text-sm text-gray-500 uppercase tracking-wide">${target.name}</span>
                    <span class="text-3xl font-bold text-gray-800 dark:text-white mt-1">${diffDays > 0 ? diffDays : 0}</span>
                    <span class="text-xs text-gray-400">Days Left</span>
                `;
                container.appendChild(el);
            });
        }

        // --- Timer Logic ---
        function formatTime(totalSeconds) {
            const h = Math.floor(totalSeconds / 3600).toString().padStart(2, '0');
            const m = Math.floor((totalSeconds % 3600) / 60).toString().padStart(2, '0');
            const s = (totalSeconds % 60).toString().padStart(2, '0');
            return `${h}:${m}:${s}`;
        }

        function startTimer() {
            if (isTimerRunning) return;
            isTimerRunning = true;
            document.getElementById('btn-start').classList.add('hidden');
            document.getElementById('btn-pause').classList.remove('hidden');
            
            timerInterval = setInterval(() => {
                timerSeconds++;
                document.getElementById('timer-display').textContent = formatTime(timerSeconds);
            }, 1000);
        }

        function pauseTimer() {
            isTimerRunning = false;
            clearInterval(timerInterval);
            document.getElementById('btn-start').classList.remove('hidden');
            document.getElementById('btn-pause').classList.add('hidden');
        }

        function stopTimer() {
            if (timerSeconds < 60) {
                if(!confirm("Less than 1 minute. Log anyway?")) {
                    resetTimerUI();
                    return;
                }
            }
            
            const subject = document.getElementById('timer-subject').value;
            const log = {
                date: new Date().toISOString(),
                subject: subject,
                durationSeconds: timerSeconds
            };
            
            logs.unshift(log); // Add to beginning
            localStorage.setItem(DB_KEY_LOGS, JSON.stringify(logs));
            
            renderLogs();
            updateTotalTime();
            resetTimerUI();
        }

        function resetTimerUI() {
            isTimerRunning = false;
            clearInterval(timerInterval);
            timerSeconds = 0;
            document.getElementById('timer-display').textContent = "00:00:00";
            document.getElementById('btn-start').classList.remove('hidden');
            document.getElementById('btn-pause').classList.add('hidden');
        }

        function renderLogs() {
            const tbody = document.getElementById('timer-logs-body');
            tbody.innerHTML = '';
            logs.slice(0, 50).forEach(log => {
                const date = new Date(log.date).toLocaleString();
                const duration = Math.floor(log.durationSeconds / 60) + ' min';
                
                const row = document.createElement('tr');
                row.className = 'border-b dark:border-gray-700';
                row.innerHTML = `
                    <td class="px-4 py-2">${date}</td>
                    <td class="px-4 py-2 font-medium">${log.subject}</td>
                    <td class="px-4 py-2 text-right">${duration}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateTotalTime() {
            const totalSeconds = logs.reduce((acc, log) => acc + log.durationSeconds, 0);
            const hours = Math.floor(totalSeconds / 3600);
            const mins = Math.floor((totalSeconds % 3600) / 60);
            document.getElementById('total-study-time').textContent = `${hours}h ${mins}m`;
        }

        // --- Scores & Charts ---
        document.getElementById('score-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('score-name').value;
            const date = document.getElementById('score-date').value;
            const subject = document.getElementById('score-subject').value;
            const val = document.getElementById('score-val').value;
            
            if(name && date && val) {
                scores.push({ name, date, subject, val: parseInt(val) });
                localStorage.setItem(DB_KEY_SCORES, JSON.stringify(scores));
                renderScores();
                document.getElementById('score-form').reset();
                document.getElementById('score-date').valueAsDate = new Date();
            }
        });

        function deleteScore(index) {
            scores.splice(index, 1);
            localStorage.setItem(DB_KEY_SCORES, JSON.stringify(scores));
            renderScores();
        }

        function renderScores() {
            const tbody = document.getElementById('score-list-body');
            tbody.innerHTML = '';
            
            // Sort by date desc
            const sortedScores = [...scores].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedScores.forEach((s) => {
                // Find original index for deletion
                const originalIndex = scores.indexOf(s);
                const row = document.createElement('tr');
                row.className = 'border-b hover:bg-gray-50 dark:border-gray-700 dark:hover:bg-gray-700 transition';
                row.innerHTML = `
                    <td class="py-2">${s.date}</td>
                    <td class="py-2">${s.name}</td>
                    <td class="py-2"><span class="px-2 py-1 text-xs rounded bg-gray-200 dark:bg-gray-600">${s.subject}</span></td>
                    <td class="py-2 font-bold ${s.val >= 70 ? 'text-green-600' : 'text-orange-500'}">${s.val}%</td>
                    <td class="py-2"><button onclick="deleteScore(${originalIndex})" class="text-red-500 hover:text-red-700"><i class="fas fa-trash"></i></button></td>
                `;
                tbody.appendChild(row);
            });

            updateCharts();
        }

        function updateCharts() {
            updateLineChart();
            updateRadarChart();
        }

        function updateLineChart() {
            const ctx = document.getElementById('scoreChart').getContext('2d');
            if (scoreChart) scoreChart.destroy();
            
            // Group by subject
            const subjects = ['Financial', 'Management', 'Audit', 'Company', 'Tax', 'Elective', 'Total'];
            const datasets = subjects.map((sub, idx) => {
                const subScores = scores.filter(s => s.subject === sub).sort((a, b) => new Date(a.date) - new Date(b.date));
                if (subScores.length === 0) return null;
                
                const colors = ['#3B82F6', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6', '#EC4899', '#6B7280'];
                
                return {
                    label: sub,
                    data: subScores.map(s => ({ x: s.date, y: s.val })),
                    borderColor: colors[idx],
                    backgroundColor: colors[idx],
                    tension: 0.1,
                    pointRadius: 4
                };
            }).filter(ds => ds !== null);

            scoreChart = new Chart(ctx, {
                type: 'line',
                data: { datasets },
                options: {
                    responsive: true,
                    interaction: { mode: 'index', intersect: false },
                    scales: {
                        x: { type: 'category', title: { display: true, text: 'Date' } },
                        y: { beginAtZero: true, max: 100, title: { display: true, text: 'Score %' } }
                    }
                }
            });
        }

        function updateRadarChart() {
            const ctx = document.getElementById('radarChart').getContext('2d');
            if (radarChart) radarChart.destroy();

            const subjects = ['Financial', 'Management', 'Audit', 'Company', 'Tax', 'Elective'];
            const averages = subjects.map(sub => {
                const subScores = scores.filter(s => s.subject === sub);
                if (subScores.length === 0) return 0;
                const sum = subScores.reduce((a, b) => a + b.val, 0);
                return sum / subScores.length;
            });

            radarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: subjects,
                    datasets: [{
                        label: 'Average Score',
                        data: averages,
                        fill: true,
                        backgroundColor: 'rgba(59, 130, 246, 0.2)',
                        borderColor: 'rgb(59, 130, 246)',
                        pointBackgroundColor: 'rgb(59, 130, 246)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgb(59, 130, 246)'
                    }]
                },
                options: {
                    scales: {
                        r: {
                            angleLines: { display: true },
                            suggestedMin: 0,
                            suggestedMax: 100
                        }
                    }
                }
            });
        }

        // --- Schedule & Roadmap Rendering ---
        function renderSchedule() {
            const tbody = document.getElementById('schedule-table-body');
            mockExams.forEach(exam => {
                const row = document.createElement('tr');
                row.className = 'border-b hover:bg-gray-50 dark:border-gray-700 dark:hover:bg-gray-700';
                
                let typeClass = exam.type === 'Short' ? 'bg-green-100 text-green-800' : 'bg-purple-100 text-purple-800';
                let statusClass = exam.status === 'Target' ? 'bg-red-100 text-red-800 font-bold' : 'bg-gray-100 text-gray-800';

                row.innerHTML = `
                    <td class="px-4 py-3">${exam.date}</td>
                    <td class="px-4 py-3"><span class="px-2 py-1 text-xs rounded-full ${typeClass}">${exam.type}</span></td>
                    <td class="px-4 py-3 font-medium">${exam.name}</td>
                    <td class="px-4 py-3 text-sm text-gray-500">${exam.provider}</td>
                    <td class="px-4 py-3"><span class="px-2 py-1 text-xs rounded-full ${statusClass}">${exam.status}</span></td>
                `;
                tbody.appendChild(row);
            });
        }

        function renderRoadmap() {
            document.getElementById('roadmap-content').innerHTML = marked.parse(roadmapMarkdown);
        }

        // --- Drills Logic ---
        const drillQuestions = {
            'Financial': [
                {
                    level: 1,
                    q: "現金預金: 貸借対照表の「現金」に含まれないものはどれですか？",
                    options: ["紙幣 (Bank notes)", "硬貨 (Coins)", "郵便切手 (Postage stamps)", "当座預金 (Demand deposits)"],
                    correct: 2,
                    explanation: "郵便切手は「貯蔵品」または「通信費」として処理され、現金には含まれません。現金には通貨、小切手、当座預金などが含まれます。"
                },
                {
                    level: 1,
                    q: "減価償却: 資産の利用量に基づいて減価償却費を計算する方法はどれですか？",
                    options: ["定額法 (Straight-line)", "定率法 (Declining-balance)", "生産高比例法 (Production-output)", "級数法 (Sum-of-the-years'-digits)"],
                    correct: 2,
                    explanation: "生産高比例法は、総見積生産量に対する当期の実際生産量の割合に基づいて費用を配分する方法です。"
                },
                {
                    level: 1,
                    q: "棚卸資産: 物価上昇局面において、当期純利益が最も大きくなる評価方法はどれですか？",
                    options: ["先入先出法 (FIFO)", "後入先出法 (LIFO)", "移動平均法 (Weighted Average)", "個別法 (Specific Identification)"],
                    correct: 0,
                    explanation: "先入先出法(FIFO)では、過去の（安い）在庫が先に売上原価となり、期末在庫に直近の（高い）単価が残るため、売上原価が小さくなり利益が大きくなります。"
                },
                {
                    level: 1,
                    q: "資産除去債務: 資産除去債務は当初何をもって測定されますか？",
                    options: ["除去費用の将来価値", "除去費用の割引現在価値", "資産の取得原価", "資産の公正価値"],
                    correct: 1,
                    explanation: "資産除去債務は、将来発生すると見込まれる除去費用の「割引現在価値」で算定されます。"
                },
                {
                    level: 1,
                    q: "一般原則: 企業会計原則の「真実性の原則」における「真実」の意味として正しいものはどれですか？",
                    options: ["絶対的真実", "相対的真実", "形式的真実", "法的真実"],
                    correct: 1,
                    explanation: "企業会計は複数の会計処理の原則・手続の選択適用を認めているため、求められるのは「相対的真実」であると解されます。"
                },
                {
                    level: 1,
                    q: "減損会計: 固定資産の「回収可能価額」とは、どのように算定されますか？",
                    options: ["正味売却価額と使用価値のいずれか高い金額", "正味売却価額と使用価値のいずれか低い金額", "正味売却価額のみ", "使用価値のみ"],
                    correct: 0,
                    explanation: "回収可能価額は、資産の「正味売却価額」と「使用価値」のいずれか高い方の金額とされます。"
                },
                {
                    level: 1,
                    q: "リース会計: ファイナンス・リース取引において、借手が計上する資産の額は原則としていくらですか？",
                    options: ["リース料総額", "リース料総額の割引現在価値と貸手の購入価額等のいずれか低い額", "貸手の購入価額", "リース料総額の割引現在価値"],
                    correct: 1,
                    explanation: "通常のファイナンス・リースでは、リース料総額の現在価値と、貸手の購入価額（現金購入価額）のいずれか低い額で資産計上します。"
                },
                {
                    level: 2,
                    q: "キャッシュ・フロー計算書: 間接法において、税引前当期純利益からスタートする際、減価償却費はどう調整しますか？",
                    options: ["加算する", "減算する", "調整しない", "営業外収益として扱う"],
                    correct: 0,
                    explanation: "減価償却費は現金支出を伴わない費用（非資金損益）であるため、利益からスタートしてキャッシュフローを求める際は「加算」して戻します。"
                },
                {
                    level: 3,
                    q: "税効果会計: 繰延税金資産の回収可能性を判断する際、会社分類が「分類2」の企業において、スケジューリング可能な一時差異はいつまで計上可能ですか？",
                    options: ["1年以内", "5年以内", "スケジューリング可能な全期間", "計上できない"],
                    correct: 2,
                    explanation: "「分類2（業績が安定している企業）」の場合、スケジューリング可能な将来減算一時差異については、期間制限なく（全期間）回収可能性があると判断されます。"
                }
            ],
            'Management': [
                {
                    level: 1,
                    q: "CVP分析: 損益分岐点売上高を求める計算式はどれですか？",
                    options: ["固定費 ÷ 貢献利益率", "固定費 ÷ 変動費率", "変動費 ÷ 売上高", "利益 ÷ 売上高"],
                    correct: 0,
                    explanation: "損益分岐点売上高 ＝ 固定費 ÷ (1 － 変動費率) ＝ 固定費 ÷ 貢献利益率 です。"
                },
                {
                    level: 1,
                    q: "原価の分類: 「素価 (Prime Cost)」を構成するものはどれですか？",
                    options: ["直接材料費 ＋ 直接労務費", "直接労務費 ＋ 製造間接費", "直接材料費 ＋ 製造間接費", "販売費及び一般管理費"],
                    correct: 0,
                    explanation: "素価（Prime Cost）は、直接材料費と直接労務費の合計です。（加工費 ＝ 直接労務費 ＋ 製造間接費）"
                },
                {
                    level: 1,
                    q: "標準原価計算: 実際消費量が標準消費量を上回った場合に発生する差異はどれですか？",
                    options: ["有利数量差異", "不利数量差異", "有利価格差異", "不利価格差異"],
                    correct: 1,
                    explanation: "標準よりも多くの数量を消費してしまった場合は、コスト増となるため「不利差異（Unfavorable）」となります。"
                },
                {
                    level: 1,
                    q: "直接原価計算: 固定製造間接費はどのように処理されますか？",
                    options: ["製品原価として処理", "期間原価として処理", "資産として計上", "負債として計上"],
                    correct: 1,
                    explanation: "直接原価計算では、固定製造間接費は発生時に「期間原価」として全額費用処理されます（CVP分析に有用）。"
                },
                {
                    level: 1,
                    q: "原価計算基準: 原価計算基準において、原価計算の目的として挙げられていないものはどれですか？",
                    options: ["財務諸表の作成", "原価管理", "予算統制", "従業員給与の計算"],
                    correct: 3,
                    explanation: "原価計算基準には、財務諸表作成、価格計算、原価管理、予算管理、基本計画策定の5つの目的が挙げられていますが、給与計算は含まれません。"
                },
                {
                    level: 1,
                    q: "ABC (活動基準原価計算): 製造間接費を製品に配賦するために使用される基準は何ですか？",
                    options: ["操業度", "コスト・ドライバー (活動原価要因)", "直接作業時間", "機械稼働時間"],
                    correct: 1,
                    explanation: "ABCでは、製造間接費を活動ごとに把握し、それぞれの活動の発生要因である「コスト・ドライバー」に基づいて製品に配賦します。"
                },
                {
                    level: 1,
                    q: "投資の経済性計算: ROI (投下資本利益率) を求める計算式はどれですか？",
                    options: ["利益 ÷ 売上高", "売上高 ÷ 投下資本", "利益 ÷ 投下資本", "投下資本 ÷ 利益"],
                    correct: 2,
                    explanation: "ROI (Return On Investment) は、利益を投下資本で割って算出します（ROI = 売上高利益率 × 資本回転率）。"
                },
                {
                    level: 2,
                    q: "CVP分析: 固定費1,000、変動費率0.6、目標利益200の場合、目標売上高はいくらですか？",
                    options: ["2,000", "3,000", "2,500", "1,200"],
                    correct: 1,
                    explanation: "目標売上高 ＝ (固定費 ＋ 目標利益) ÷ (1 － 変動費率) ＝ (1000 + 200) ÷ 0.4 ＝ 3000 です。"
                }
            ],
            'Audit': [
                {
                    level: 1,
                    q: "監査リスク: 監査リスク・モデルの構成要素として正しいものはどれですか？",
                    options: ["固有リスク × 統制リスク × 発見リスク", "ビジネスリスク × 監査リスク", "重要性 × リスク", "抽出リスク × 非抽出リスク"],
                    correct: 0,
                    explanation: "監査リスク ＝ 重要な虚偽表示リスク（固有リスク×統制リスク） × 発見リスク です。"
                },
                {
                    level: 1,
                    q: "独立性: 「外観的独立性」を損なう要因となるものはどれですか？",
                    options: ["被監査会社の株式保有", "誠実であること", "専門能力を有すること", "倫理規定の遵守"],
                    correct: 0,
                    explanation: "被監査会社の株式や重要な経済的利害関係を有することは、外観的独立性（第三者から見て独立していると見えること）を損ないます。"
                },
                {
                    level: 1,
                    q: "監査意見: 財務諸表全体に重要な虚偽表示があり、かつその影響が広範である場合に表明される意見はどれですか？",
                    options: ["無限定適正意見", "限定付適正意見", "不適正意見", "意見不表明"],
                    correct: 2,
                    explanation: "重要かつ広範（Pervasive）な虚偽表示がある場合は、「不適正意見（Adverse Opinion）」が表明されます。"
                },
                {
                    level: 1,
                    q: "内部統制: 内部統制の整備・運用責任は誰にありますか？",
                    options: ["監査人", "経営者", "株主", "政府"],
                    correct: 1,
                    explanation: "内部統制を整備し運用する責任は「経営者」にあります。監査人はその有効性を評価・報告する立場です。"
                },
                {
                    level: 1,
                    q: "監査証拠: 一般的に最も証明力が高いとされる監査証拠はどれですか？",
                    options: ["経営者への質問", "観察", "外部確認", "社内文書"],
                    correct: 2,
                    explanation: "外部の第三者から直接入手する「確認（External Confirmation）」は、一般に社内証拠よりも証明力が高いとされます。"
                },
                {
                    level: 1,
                    q: "不正対応: 「不正のトライアングル」の3要素に含まれないものはどれですか？",
                    options: ["動機・プレッシャー", "機会", "姿勢・正当化", "罰則"],
                    correct: 3,
                    explanation: "不正のトライアングルは、「動機・プレッシャー」「機会」「姿勢・正当化」の3要素から構成されます。"
                },
                {
                    level: 1,
                    q: "監査報告書: 監査報告書日はいつであるべきですか？",
                    options: ["決算日", "監査人が監査意見を形成するのに十分かつ適切な監査証拠を入手した日", "株主総会開催日", "有価証券報告書提出日"],
                    correct: 1,
                    explanation: "監査報告書日は、監査人が意見表明の基礎となる十分かつ適切な監査証拠を入手した日（監査終了日）とする必要があります。"
                }
            ],
            'Company': [
                {
                    level: 1,
                    q: "設立: 株式会社の設立における最低資本金の額はいくらですか？",
                    options: ["1,000万円", "300万円", "1円", "0円"],
                    correct: 2,
                    explanation: "現在の会社法では、最低資本金制度は撤廃されており、資本金1円から設立が可能です。"
                },
                {
                    level: 1,
                    q: "自己株式: 株式会社は自己株式を取得することができますか？",
                    options: ["完全に禁止されている", "財源規制等の下で認められる", "自由に認められる", "解散時のみ認められる"],
                    correct: 1,
                    explanation: "自己株式の取得は、分配可能額の範囲内であることや株主総会決議などの規制の下で認められています。"
                },
                {
                    level: 1,
                    q: "機関設計: 取締役会設置会社における取締役の最低人数は何人ですか？",
                    options: ["1人", "2人", "3人", "5人"],
                    correct: 2,
                    explanation: "取締役会を設置する場合、取締役は3人以上必要です。"
                },
                {
                    level: 1,
                    q: "株主総会: 特別決議の定足数は原則としてどのくらいですか？",
                    options: ["議決権の過半数", "議決権の3分の1", "議決権の3分の2", "全株主"],
                    correct: 0,
                    explanation: "特別決議の定足数は原則として「議決権の過半数」です（定款で3分の1まで緩和可）。決議要件は出席株主の議決権の3分の2以上です。"
                },
                {
                    level: 1,
                    q: "監査役: 監査役の任期は原則として何年ですか？",
                    options: ["1年", "2年", "4年", "10年"],
                    correct: 2,
                    explanation: "監査役の任期は原則として4年です。定款によっても短縮することはできません。"
                },
                {
                    level: 1,
                    q: "株主の権利: 単独株主権（1株でも保有していれば行使できる権利）はどれですか？",
                    options: ["株主総会招集請求権", "帳簿閲覧請求権", "剰余金配当請求権", "取締役解任請求権"],
                    correct: 2,
                    explanation: "剰余金配当請求権や議決権は、1株から認められる単独株主権です。帳簿閲覧権などは一定の株式数・期間が必要な少数株主権です。"
                },
                {
                    level: 1,
                    q: "事業譲渡: 株主総会の特別決議が必要となる事業譲渡はどれですか？",
                    options: ["事業の全部または重要な一部の譲渡", "重要な資産の処分", "多額の借財", "支配人の選任"],
                    correct: 0,
                    explanation: "事業の全部の譲渡、または事業の重要な一部の譲渡（譲渡資産が総資産の1/5超など）には、株主総会の特別決議が必要です。"
                }
            ]
        };

        let currentQuiz = {
            subject: null,
            questions: [],
            index: 0,
            score: 0
        };
        
        let currentSubject = null;

        function selectSubject(subject) {
            currentSubject = subject;
            document.getElementById('quiz-intro').classList.add('hidden');
            document.getElementById('quiz-container').classList.add('hidden');
            document.getElementById('quiz-result').classList.add('hidden');
            document.getElementById('level-selection').classList.remove('hidden');
            document.getElementById('level-select-title').textContent = `${subject}: Select Level`;
        }

        function startQuiz(subject, level = null) {
            const subj = subject || currentSubject;
            currentQuiz.subject = subj;
            
            let questions = drillQuestions[subj];
            
            // Filter by level if specified
            if (level) {
                const leveledQuestions = questions.filter(q => q.level === level);
                // If we found questions for this level, use them.
                // If not, and we asked for Level 1, we might include questions without a level property (legacy support)
                if (leveledQuestions.length > 0) {
                    questions = leveledQuestions;
                } else if (level === 1) {
                    const legacyQuestions = questions.filter(q => q.level === undefined);
                    if (legacyQuestions.length > 0) {
                        questions = legacyQuestions;
                    } else {
                        // Truly no questions
                        alert(`No questions available for ${subj} yet.`);
                        return;
                    }
                } else {
                    alert(`Level ${level} questions for ${subj} are coming soon! Please try Level 1.`);
                    return;
                }
            }
            
            currentQuiz.questions = [...questions]; // Shallow copy
            currentQuiz.index = 0;
            currentQuiz.score = 0;

            document.getElementById('level-selection').classList.add('hidden');
            document.getElementById('quiz-intro').classList.add('hidden');
            document.getElementById('quiz-result').classList.add('hidden');
            document.getElementById('quiz-container').classList.remove('hidden');
            
            const levelText = level ? ` (Level ${level})` : "";
            document.getElementById('quiz-subject-title').textContent = subj + " Drill" + levelText;
            
            showQuestion();
        }

        function showQuestion() {
            const q = currentQuiz.questions[currentQuiz.index];
            document.getElementById('quiz-progress').textContent = `Q${currentQuiz.index + 1} / ${currentQuiz.questions.length}`;
            document.getElementById('quiz-question-text').textContent = q.q;
            
            const optsContainer = document.getElementById('quiz-options');
            optsContainer.innerHTML = '';
            
            q.options.forEach((opt, idx) => {
                const btn = document.createElement('button');
                btn.className = 'w-full text-left p-4 rounded-lg border border-gray-200 hover:bg-blue-50 hover:border-blue-300 transition option-btn';
                btn.onclick = () => checkAnswer(idx, btn);
                btn.innerHTML = `<span class="font-bold mr-2">${String.fromCharCode(65+idx)}.</span> ${opt}`;
                optsContainer.appendChild(btn);
            });

            document.getElementById('quiz-feedback').classList.add('hidden');
            document.getElementById('btn-next-question').classList.add('hidden');
        }

        function checkAnswer(selectedIndex, btnElement) {
            // Disable all buttons
            document.querySelectorAll('.option-btn').forEach(b => b.disabled = true);
            
            const q = currentQuiz.questions[currentQuiz.index];
            const isCorrect = selectedIndex === q.correct;
            
            if (isCorrect) {
                currentQuiz.score++;
                btnElement.classList.remove('border-gray-200', 'hover:bg-blue-50');
                btnElement.classList.add('bg-green-100', 'border-green-500', 'text-green-800');
                document.getElementById('feedback-title').textContent = "Correct! 🎉";
                document.getElementById('feedback-title').className = "font-bold mb-2 text-green-600";
            } else {
                btnElement.classList.remove('border-gray-200', 'hover:bg-blue-50');
                btnElement.classList.add('bg-red-100', 'border-red-500', 'text-red-800');
                
                // Highlight correct answer
                const correctBtn = document.querySelectorAll('.option-btn')[q.correct];
                correctBtn.classList.add('bg-green-100', 'border-green-500', 'text-green-800');
                
                document.getElementById('feedback-title').textContent = "Incorrect";
                document.getElementById('feedback-title').className = "font-bold mb-2 text-red-600";
            }

            document.getElementById('feedback-text').textContent = q.explanation;
            document.getElementById('quiz-feedback').classList.remove('hidden');
            document.getElementById('btn-next-question').classList.remove('hidden');
        }

        function nextQuestion() {
            currentQuiz.index++;
            if (currentQuiz.index < currentQuiz.questions.length) {
                showQuestion();
            } else {
                finishQuiz();
            }
        }

        function finishQuiz() {
            document.getElementById('quiz-container').classList.add('hidden');
            document.getElementById('quiz-result').classList.remove('hidden');
            document.getElementById('quiz-final-score').textContent = `${currentQuiz.score} / ${currentQuiz.questions.length}`;
        }

        function resetQuizUI() {
            document.getElementById('quiz-result').classList.add('hidden');
            document.getElementById('quiz-container').classList.add('hidden');
            document.getElementById('level-selection').classList.add('hidden');
            document.getElementById('quiz-intro').classList.remove('hidden');
        }
    </script>
</body>
</html>
